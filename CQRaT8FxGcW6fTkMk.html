<html><head><base href="/">
<meta charset="UTF-8">
<title>AI音樂中文創作者排行榜</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
body {
  background: #e6f3ff; /* Lighter blue background */
  font-family: "Microsoft JhengHei", -apple-system, BlinkMacSystemFont, sans-serif;
  margin: 0;
  padding: 20px;
  min-height: 100vh;
}

.container {
  max-width: 800px;
  margin: 0 auto;
  background: #ffffff;
  border-radius: 20px; /* Rounder corners */
  padding: 25px;
  box-shadow: 0 8px 16px rgba(52, 152, 219, 0.15); /* Softer blue shadow */
}

h1 {
  text-align: center;
  color: #3498db; /* Brighter blue */
  font-size: 2.4em;
  margin-bottom: 25px;
  font-weight: 600;
}

.filter-container {
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.view-toggle {
  display: flex;
  gap: 8px;
  margin-right: 15px;
}

.view-btn {
  padding: 8px 16px;
  border: 2px solid #bde0ff; /* Light blue border */
  border-radius: 12px; /* Rounder corners */
  background: white;
  cursor: pointer;
  transition: all 0.3s ease;
  color: #3498db;
}

.view-btn:hover {
  background: #f0f8ff;
}

.view-btn.active {
  background: #3498db;
  color: white;
  border-color: #3498db;
  box-shadow: 0 4px 8px rgba(52, 152, 219, 0.2);
}

select {
  padding: 8px 12px;
  border-radius: 12px;
  border: 2px solid #bde0ff;
  font-size: 14px;
  background: white;
  cursor: pointer;
  color: #3498db;
}

.music-btn {
  background: none;
  border: none;
  cursor: pointer;
  color: #3498db;
  font-size: 1.2em;
  padding: 4px 8px;
  transition: color 0.3s ease;
}

.music-btn:hover {
  color: #2980b9;
}

.ssc6-info {
  display: none;
  background: #f0f8ff;
  padding: 20px;
  border-radius: 15px;
  margin: 15px 0;
  border-left: 4px solid #3498db;
  line-height: 1.6;
}

.ssc6-info a {
  color: #3498db;
  text-decoration: none;
  font-weight: bold;
}

.ssc6-info a:hover {
  text-decoration: underline;
}

.hidden {
  display: none !important;
}

.intro {
  margin-bottom: 20px;
  color: #34495e;
  line-height: 1.6;
  font-size: 1.05em;
  padding: 20px;
  background: #f0f8ff;
  border-radius: 15px;
  border-left: 4px solid #3498db;
}

.update-info {
  text-align: right;
  color: #7f8c8d;
  font-size: 0.9em;
  margin-top: 8px;
}

.ranking-list {
  list-style: none;
  padding: 0;
}

.ranking-item {
  display: flex;
  align-items: center;
  padding: 15px 20px;
  margin: 8px 0;
  border-radius: 15px;
  transition: all 0.3s ease;
  background: #ffffff;
  border: 2px solid #e1e8ed;
  cursor: pointer;
}

.ranking-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(52, 152, 219, 0.15);
  border-color: #bde0ff;
}

.rank {
  font-size: 1.8em;
  font-weight: 600;
  margin-right: 16px;
  width: 40px;
  text-align: center;
  color: #2c3e50;
}

.creator-info {
  flex-grow: 1;
}

.creator-name {
  font-size: 1.2em;
  font-weight: 600;
  margin-bottom: 4px;
  color: #2c3e50;
}

.song-title {
  font-size: 0.9em;
  color: #666;
  margin-left: 8px;
  font-style: italic;
}

.song-title:before {
  content: "「";
}

.song-title:after {
  content: "」";
}

.fans-count {
  color: #576574;
  font-size: 1em;
  display: flex;
  align-items: center;
  gap: 4px;
}

.rank-1 {
  background: linear-gradient(135deg, #fff9e6 0%, #fff5d6 100%);
  border: 2px solid #ffd700;
}

.rank-2 {
  background: linear-gradient(135deg, #f8f9fa 0%, #f1f3f5 100%);
  border: 2px solid #ced4da;
}

.rank-3 {
  background: linear-gradient(135deg, #fff0e6 0%, #ffe8d6 100%);
  border: 2px solid #cd7f32;
}

.fans-change {
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 0.9em;
  font-weight: 500;
}

.increase {
  color: #00a65a;
  background-color: #ebfaf0;
}

.decrease {
  color: #dc3545;
  background-color: #ffebee;
}

.new-entry {
  background-color: #e8f5e9;
  padding: 2px 8px;
  border-radius: 4px;
  color: #00a65a;
  font-weight: 500;
  margin-left: 8px;
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(2px);
  z-index: 1000;
}

.modal-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 30px;
  border-radius: 20px;
  width: 90%;
  max-width: 700px;
  box-shadow: 0 8px 24px rgba(52, 152, 219, 0.2);
  max-height: 80vh;
  overflow-y: auto;
}

.close-btn {
  position: absolute;
  right: 16px;
  top: 12px;
  font-size: 24px;
  cursor: pointer;
  color: #666;
  transition: color 0.2s;
}

.close-btn:hover {
  color: #333;
}

#modalTitle {
  line-height: 1.4;
  color: #2c3e50;
  font-size: 1.4em;
  margin-bottom: 20px;
  padding-right: 24px;
}

.competition-badge {
  display: inline-flex;
  align-items: center;
  background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
  color: white;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.85em;
  margin-left: 8px;
  font-weight: normal;
  box-shadow: 0 2px 4px rgba(52, 152, 219, 0.2);
}

.competition-badge:before {
  content: "🎮";
  margin-right: 4px;
}

.rank-tied {
  background: linear-gradient(135deg, #e6f3ff 0%, #d1e8ff 100%);
  border: 2px solid #3498db;
}

.summary-section {
  margin-top: 30px;
  padding-top: 20px;
  border-top: 1px solid #eee;
}

.summary-section h2 {
  text-align: center;
  color: #2c3e50;
  font-size: 1.8em;
  margin-bottom: 20px;
}

.join-us-section {
  max-width: 600px;
  margin: 0 auto;
  padding: 20px;
}

.join-form {
  background: #f8faff;
  padding: 25px;
  border-radius: 15px;
  box-shadow: 0 4px 8px rgba(52, 152, 219, 0.1);
}

.form-group {
  margin-bottom: 15px;
}

.form-group label {
  display: block;
  margin-bottom: 5px;
  color: #2c3e50;
  font-weight: 500;
}

.form-group input {
  width: 100%;
  padding: 8px 12px;
  border: 2px solid #bde0ff;
  border-radius: 6px;
  font-size: 14px;
}

.submit-btn {
  background: #3498db;
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 500;
  width: 100%;
  transition: all 0.3s ease;
}

.submit-btn:hover {
  background: #2980b9;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(52, 152, 219, 0.2);
}

.submission-result {
  margin-top: 20px;
  padding: 20px;
  background: #f8f9fa;
  border-radius: 8px;
  border-left: 4px solid #3498db;
}

.submission-result h3 {
  margin-top: 0;
  color: #2c3e50;
}

.chart-container {
  margin: 30px 0;
  padding: 20px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

@media (max-width: 600px) {
  .container {
    padding: 15px;
  }
  
  h1 {
    font-size: 1.8em;
  }
  
  .ranking-item {
    padding: 10px;
  }
}
</style>
</head>
<body>

<div class="container">
    <h1>🎵 AI音樂中文創作者總排行榜 🎵</h1>

    <div class="filter-container">
      <div class="view-toggle">
        <button id="followersView" class="view-btn active">追蹤數</button>
        <button id="likesView" class="view-btn">熱門曲按讚數</button>
        <button id="ssc6View" class="view-btn">SSC實況</button>
        <button id="statsView" class="view-btn">統計</button>
        <button id="joinUsView" class="view-btn">加入我們</button>
      </div>
      <select id="filterSelect">
        <option value="all">全部顯示</option>
        <option value="1k">超過1k</option>
        <option value="500">超過500</option>
        <option value="ssc6">參與SSC6</option>
        <option value="aimac">AI music collective</option>
        <option value="new">New</option>
      </select>
    </div>

    <div id="ssc6Info" class="ssc6-info">
      SSC6是一個全球性的音樂比賽，貢獻您的創造力，與世界各地的朋友聯繫，欣賞鼓舞人心的音樂！
      <br>
      <a href="https://sunosongcontest.github.io/rules/" target="_blank">了解更多 →</a>
    </div>

    <div id="aimacInfo" class="ssc6-info">
      AI music collective是NDAI中的部分成員
      <br>
      <a href="https://rockworthgames.com/AIMACtest/index.html" target="_blank">了解更多 →</a>
    </div>

    <div class="intro">
      目前，人工智慧（AI）技術在音樂創作領域的應用日益成熟，全球各地的音樂家和創作者正積極探索AI音樂生成工具的潛力。以下是目前排名：
      <div class="update-info">（24/11/16更新）</div>
    </div>
    
    <div class="intro" id="likesIntro" style="display: none;">
      熱門歌曲在中文AI音樂社區中掀起浪潮，每個音符都成為創作者交流的橋梁。無論是情感抒發還是技術突破，中文AI音樂社區讓創意在音樂世界無限廣大。
      <div class="update-info">（24/11/16更新）</div>
    </div>
    
    <ul class="ranking-list" id="rankingList">
  <!-- Here's a direct link to a song on Suno: -->
  <a href="https://suno.com/song/04440f12-078f-434c-837e-4fac9990713d">Listen on Suno</a>
</ul>

    <div id="joinUsSection" class="join-us-section" style="display: none;">
      <form id="joinUsForm" class="join-form">
        <div class="form-group">
          <label for="authorName">名稱:</label>
          <input type="text" id="authorName" required="">
        </div>
        <div class="form-group">  
          <label for="nationality">國籍:</label>
          <input type="text" id="nationality" required="">
        </div>
        <div class="form-group">
          <label for="followers">目前追蹤數:</label>
          <input type="number" id="followers" required="">
        </div>
        <div class="form-group">
          <label for="sunoLink">Suno中文歌曲連結:</label>
          <input type="url" id="sunoLink" required="">
        </div>
        <button type="submit" class="submit-btn">送出</button>
      </form>

      <div id="submissionResult" class="submission-result" style="display: none;">
        <h3>提交結果(請立即連繫discord:@gameagate636934)</h3>
        <p>隨機條碼: <span id="randomCode"></span></p>
        <p>作家: <span id="resultName"></span></p>
        <p>國籍: <span id="resultNationality"></span></p>
        <p>追蹤數: <span id="resultFollowers"></span></p>
      </div>
    </div>
  
    <div id="statsSection" style="display: none;">
      <div class="summary-section">
        <h2>統計總覽</h2>
        <div class="chart-container">
          <canvas id="followersLineChart"></canvas>
        </div>
        <div class="chart-container">
          <canvas id="followersBarChart"></canvas>
        </div>
        <div class="chart-container">
          <canvas id="countryChart"></canvas>
        </div>
        <div class="chart-container">
          <canvas id="likesBarChart"></canvas>
        </div>
      </div>
    </div>
</div>

<div id="trendModal" class="modal">
    <div class="modal-content">
      <span class="close-btn">×</span>
      <h2 id="modalTitle">nyx</h2>
      <div></div>
      <canvas id="trendChart"></canvas>
    </div>
</div>

<script>
let followersLineChart = null;
let followersBarChart = null;
let countryChart = null;
let likesBarChart = null;

const formatNumber = (num) => {
  return num >= 1000 ? (num/1000).toFixed(1) + 'k' : num;
};

// Add this function near the top of the script section, before other functions
function showNoMusicAlert() {
  alert("音樂播放功能即將上線！");
}

// Populating song likes data structure
const songLikes = [
  { name: "brutus", song: "under the moon", likes: 2900 },
  { name: "nyx", song: "離れる", likes: 763 },
  { name: "Bojian", song: "無法救贖", likes: 487 },
  { name: "二月", song: "醉舞江湖", likes: 352 },
  { name: "酒愛花", song: "I am separated from the world✨", likes: 676 },
  { name: "GameIsHere", song: "Space", likes: 518 },
  { name: "coft", song: "Unknown (feat. TongMick)", likes: 391 }
];

// Updated SSC6 status data structure
const ssc6Status = {
  "二月": { 
    status: "已淘汰",
    votes: "169票",
    rank: "半決賽17名"
  },
  "酒愛花": { status: "等待比賽" },
  "GameIsHere": { status: "等待比賽" },
  "AIMusicMoonMan": { status: "進行中" }, // Changed from "等待比賽" to "進行中"
  "ChillVibeCircuits": { 
    status: "已淘汰",
    votes: "178票",
    rank: "半決賽23名"
  }
};

// Add this after the ssc6Status object
const ssc6SongDetails = {
  "二月": {
    songName: "I Can't Love You Anymore",
    songLink: "https://suno.com/song/b9c7fd1a-dabf-4e22-80ea-a2b1575458f5",
    country: "台灣",
    votes: "169",
    status: "已淘汰"
  },
  "酒愛花": {
    songName: "ice heart", 
    songLink: "https://suno.com/song/e1615f25-6323-40e8-bcb7-48931441a300",
    country: "台灣",
    votes: "-",
    status: "等待比賽"
  },
  "GameIsHere": {
    songName: "Numb",
    songLink: "https://suno.com/song/570c5beb-fcb2-4968-9d40-ee6cef6b0696", 
    country: "台灣",
    votes: "-",
    status: "等待比賽"
  },
  "AIMusicMoonMan": {
    songName: "ひゃっきやぎょう",
    songLink: "https://suno.com/song/916fe5e6-af7a-482b-9bb9-8530f88eeeb6",
    country: "台灣",
    votes: "-",
    status: "進行中"
  },
  "ChillVibeCircuits": {
    songName: "恋の竖琴 (Harp of Love)",
    songLink: "https://suno.com/song/b7906558-21ad-40fa-bc1d-057789c0ba69",
    country: "馬來西亞",
    votes: "178",
    status: "已淘汰"
  }
};

// New SSC5 data structure
const ssc5Status = {
  "酒愛花": { 
    status: "已淘汰"
  },
  "二月": {
    status: "已淘汰"
  },
  "GameIsHere": {
    status: "已淘汰"
  },
  "coft": {
    status: "已淘汰"
  },
  "ChillVibeCircuits": {
    status: "已淘汰"
  }
};

// Update the ssc6Participants array
const ssc6Participants = ["二月", "酒愛花", "GameIsHere", "AIMusicMoonMan", "ChillVibeCircuits"];
const ssc5Participants = ["酒愛花", "二月", "GameIsHere", "coft", "ChillVibeCircuits"];
const aimacParticipants = ["GameIsHere", "brutus", "coft"]; // Update the aimacParticipants array

const previousData = {
  "GameIsHere": 804,
  "二月": 732,
  "酒愛花": 710,
  "ChillVibeCircuits": 217,
  "CYAN [青幻]": 181,
  "桂花巷子": 233,
  "coft": 249,
  "球球": 72,
  "Maybe": 56,
  "Bojian": 70,
  "AIMusicMoonMan": 40,
  "nyx": Math.round(3800 * 0.6)
};

// Updated creators array to include flag information
const creators = [
  { name: "brutus", fans: 4200, isNew: true, flag: "🇯🇵" },
  { name: "nyx", fans: 3800, isNew: true, flag: "🇹🇼" },
  { name: "Bojian", fans: 1200, flag: "🇹🇼" },
  { name: "二月", fans: 1000, flag: "🇹🇼" },
  { name: "酒愛花", fans: 1000, flag: "🇹🇼" },
  { name: "GameIsHere", fans: 1000, flag: "🇹🇼" },
  { name: "coft", fans: 703, flag: "🇭🇰" }, // Updated from 599 to 703
  { name: "桂花巷子", fans: 435, flag: "🇹🇼" },
  { name: "ChillVibeCircuits", fans: 341, flag: "🇲🇾" },
  { name: "CYAN [青幻]", fans: 207, flag: "🇨🇳" },
  { name: "Maybe", fans: 127, flag: "🇹🇼" }, // Added Taiwan flag
  { name: "球球", fans: 96, flag: "🇹🇼" }, // Added Taiwan flag
  { name: "AIMusicMoonMan", fans: 76, flag: "🇹🇼" }
];

creators.sort((a, b) => b.fans - a.fans);

const rankingList = document.getElementById('rankingList');
const modal = document.getElementById('trendModal');
const closeBtn = document.querySelector('.close-btn');
let currentChart = null;
let currentView = 'followers'; // Track current view

closeBtn.onclick = () => {
  modal.style.display = 'none';
};

window.onclick = (event) => {
  if (event.target === modal) {
    modal.style.display = 'none';
  }
};

function generateTrendData(currentFans, previousFans, maxValue = null) {
  const points = 6;
  const data = [];
  const labels = [];
  const predictedData = [];
  const averageData = [];
  
  // Calculate global average change
  const allChanges = creators.map(c => {
    const prev = previousData[c.name] || 0;
    return {
      start: prev,
      end: c.fans,
      change: c.fans - prev
    };
  });
  
  const avgChange = allChanges.reduce((sum, curr) => sum + curr.change, 0) / allChanges.length;
  const avgStart = allChanges.reduce((sum, curr) => sum + curr.start, 0) / allChanges.length;
  const avgEnd = allChanges.reduce((sum, curr) => sum + curr.end, 0) / allChanges.length;
  
  data.push(0);
  predictedData.push(0);
  averageData.push(0);
  labels.push('');
  
  for(let i = 1; i < points-1; i++) {
    const progress = i / (points-1);
    const exponentialProgress = Math.pow(progress, 2);
    const estimatedFans = Math.round(previousFans * exponentialProgress);
    const avgPoint = Math.round(avgStart + (avgChange * progress));
    
    data.push(null);
    predictedData.push(estimatedFans);
    averageData.push(avgPoint);
    labels.push('');
  }
  
  data.push(previousFans);
  predictedData.push(previousFans);
  averageData.push(avgStart);
  labels.push('上月');
  
  data.push(currentFans);
  predictedData.push(currentFans);
  averageData.push(avgEnd);
  labels.push('本月');
  
  return { 
    data, 
    predictedData, 
    averageData, 
    labels,
    maxValue: maxValue || Math.max(currentFans, previousFans) * 1.1
  };
}

function showTrendChart(creator) {
  const modalTitle = document.getElementById('modalTitle');
  
  // Remove any existing scale toggle button first
  const existingToggle = document.getElementById('scaleToggle');
  if (existingToggle) {
    existingToggle.remove();
  }
  
  // Add a single scale toggle button
  const scaleToggle = document.createElement('button');
  scaleToggle.id = 'scaleToggle';
  scaleToggle.className = 'view-btn';
  scaleToggle.style.fontSize = '0.8em';
  scaleToggle.style.marginTop = '10px';
  scaleToggle.style.marginBottom = '10px';
  scaleToggle.textContent = '切換Y軸比例';
  
  modalTitle.insertAdjacentElement('afterend', scaleToggle);
  
  // Get likes info
  const likesInfo = songLikes.find(s => s.name.toLowerCase() === creator.name.toLowerCase());
  const likesText = likesInfo ? `熱門曲按讚數: ${formatNumber(likesInfo.likes)}` : '熱門曲按讚數: 無';
  
  // Get badges
  const isSSC6 = ssc6Participants.includes(creator.name);
  const isSSC5 = ssc5Participants.includes(creator.name);
  const isAIMAC = aimacParticipants.includes(creator.name);
  const badges = [
    isSSC6 ? '<span class="competition-badge">SSC6</span>' : '',
    isSSC5 ? '<span class="competition-badge" style="background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);">SSC5</span>' : '',
    isAIMAC ? '<span class="competition-badge" style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);">AMC(NDAI)</span>' : ''
  ].filter(b => b).join(' ');

  // Get SSC6 details if available
  const ssc6Details = ssc6SongDetails[creator.name];
  const ssc6Info = ssc6Details ? `
    <div style="margin-top:15px; padding:15px; background:#f8f9fa; border-radius:8px; font-size:0.9em;">
      <h3 style="margin:0 0 10px 0; color:#2c3e50;">SSC6 參賽資訊</h3>
      <div><strong>歌名:</strong> ${ssc6Details.songName}</div>
      <div><strong>連結:</strong> <a href="${ssc6Details.songLink}" target="_blank" style="color:#3498db;">聆聽歌曲</a></div>
      <div><strong>代表國家:</strong> ${ssc6Details.country}</div>
      <div><strong>得票數:</strong> ${ssc6Details.votes}</div>
      <div><strong>狀態:</strong> ${ssc6Details.status}</div>
    </div>
  ` : '';

  modalTitle.innerHTML = `
    <div style="margin-bottom:10px">
      ${creator.name} ${creator.flag || ''} ${badges}
    </div>
    <div style="font-size: 0.9em; color: #666; margin-bottom:10px">
      ${likesText}
    </div>
    ${ssc6Info}
  `;

  const { data, predictedData, averageData, labels, maxValue } = generateTrendData(
    creator.fans, 
    previousData[creator.name] || 0
  );
  
  // Calculate global max value for y-axis
  const globalMax = Math.max(
    ...creators.map(c => c.fans),
    ...Object.values(previousData)
  );
  
  if (currentChart) {
    currentChart.destroy();
  }
  
  const ctx = document.getElementById('trendChart').getContext('2d');
  currentChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [
        {
          label: '實際追蹤數',
          data: data,
          borderColor: '#3498db',
          backgroundColor: 'rgba(52, 152, 219, 0.1)',
          fill: true,
          tension: 0.4
        },
        {
          label: '預測趨勢',
          data: predictedData,
          borderColor: '#3498db',
          borderDash: [5, 5],
          backgroundColor: 'rgba(52, 152, 219, 0.1)',
          fill: false,
          tension: 0.4
        },
        {
          label: '全體平均',
          data: averageData,
          borderColor: '#e74c3c',
          borderDash: [3, 3],
          backgroundColor: 'transparent',
          fill: false,
          tension: 0.4
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          max: maxValue, // Set max value for y-axis
          title: {
            display: true,
            text: '追蹤數'
          }
        }
      },
      plugins: {
        title: {
          display: true,
          text: '追蹤數成長趨勢'
        }
      }
    }
  });
  
  // Simplified toggle handler
  let isGlobalScale = false;
  scaleToggle.onclick = function() {
    isGlobalScale = !isGlobalScale;

    // Update chart
    currentChart.options.scales.y.max = isGlobalScale ? 
      globalMax * 1.1 : 
      Math.max(creator.fans, previousData[creator.name] || 0) * 1.1;
    currentChart.update();
  };

  modal.style.display = 'block';
}

function filterCreators(filterValue) {
  const ssc6Info = document.getElementById('ssc6Info');
  const aimacInfo = document.getElementById('aimacInfo');
  
  ssc6Info.style.display = filterValue === 'ssc6' ? 'block' : 'none';
  aimacInfo.style.display = filterValue === 'aimac' ? 'block' : 'none';

  return creators.filter(creator => {
    switch(filterValue) {
      case '1k':
        return creator.fans >= 1000;
      case '500':
        return creator.fans >= 500;
      case 'ssc6':
        return ssc6Participants.includes(creator.name);
      case 'aimac':
        return aimacParticipants.includes(creator.name); 
      case 'new':
        return creator.isNew;
      default:
        return true;
    }
  });
}

function updateList(filteredCreators) {
  rankingList.innerHTML = '';

  filteredCreators.forEach((creator, index) => {
    const li = document.createElement('li');
    
    // Determine rank class
    let rankClass = '';
    if (index < 3) {
      rankClass = `rank-${index + 1}`;
    }
    
    // Handle tied ranks for fans === 1000
    if (creator.fans === 1000) {
      rankClass = 'rank-tied';
    }
    
    li.className = `ranking-item ${rankClass}`;
    
    // Calculate display rank (handle ties)
    let displayRank = index + 1;
    if (index > 0 && creator.fans === filteredCreators[index - 1].fans) {
      displayRank = filteredCreators.findIndex(c => c.fans === creator.fans) + 1;
    }
    
    const change = creator.isNew ? 
      '<span class="new-entry">New</span>' : 
      (creator.fans - (previousData[creator.name] || 0) !== 0 ? 
        `<span class="fans-change ${creator.fans - (previousData[creator.name] || 0) > 0 ? 'increase' : 'decrease'}">
          <span class="change-arrow">${creator.fans - (previousData[creator.name] || 0) > 0 ? '↑' : '↓'}</span>
          ${Math.abs(creator.fans - (previousData[creator.name] || 0))}
        </span>` : '');
    
    const isSSC6Participant = ssc6Participants.includes(creator.name);
    const isAIMACMember = aimacParticipants.includes(creator.name);
    
    const ssc6Badge = isSSC6Participant ? `<span class="competition-badge">SSC6</span>` : '';
    const aimacBadge = isAIMACMember ? `<span class="competition-badge" style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);">AMC(NDAI)</span>` : '';

    li.innerHTML = `
      <div class="rank">${displayRank}</div>
      <div class="creator-info">
        <div class="creator-name">
          ${creator.name}
          ${creator.flag ? `<span class="flag">${creator.flag}</span>` : ''}
          ${ssc6Badge}
          ${aimacBadge}
        </div>
        <div class="fans-count">
          ${formatNumber(creator.fans)}
          ${change}
        </div>
      </div>
      <button class="music-btn" onclick="showNoMusicAlert()">
        <i class="fas fa-music"></i>
      </button>
    `;
    
    li.onclick = () => showTrendChart(creator);
    rankingList.appendChild(li);
  });
}

// New function for likes
function updateListForLikes() {
  const sortedLikes = [...songLikes].sort((a, b) => b.likes - a.likes);
  rankingList.innerHTML = '';

  sortedLikes.forEach((item, index) => {
    const li = document.createElement('li');
    let rankClass = index < 3 ? `rank-${index + 1}` : '';
    
    li.className = `ranking-item ${rankClass}`;
    
    li.innerHTML = `
      <div class="rank">${index + 1}</div>
      <div class="creator-info">
        <div class="creator-name">
          ${item.name}
          <span class="song-title">${item.song}</span>
        </div>
        <div class="fans-count">
          ${formatNumber(item.likes)} 讚
        </div>
      </div>
      <button class="music-btn" onclick="showNoMusicAlert()">
        <i class="fas fa-music"></i>
      </button>
    `;
    
    rankingList.appendChild(li);
  });
}

// New function for SSC6 status view
function updateListForSSC6() {
  rankingList.innerHTML = '';

  // SSC6 Section
  const header6 = document.createElement('div');
  header6.style.padding = "15px";
  header6.style.marginBottom = "20px";
  header6.style.borderRadius = "8px";
  header6.style.fontSize = "1.3em";
  header6.style.fontWeight = "bold";
  header6.style.background = "linear-gradient(135deg, #3498db 0%, #2980b9 100%)";
  header6.style.color = "#fff";
  header6.textContent = "SSC6賽況";
  rankingList.appendChild(header6);

  const statusGroups = {
    "進行中": [], // Make sure this exists
    "等待比賽": [],
    "已淘汰": []
  };
  
  creators.filter(c => ssc6Participants.includes(c.name)).forEach(creator => {
    const status = ssc6Status[creator.name]?.status;
    if (status) {
      statusGroups[status].push(creator);
    }
  });

  const statusStyles = {
    "進行中": {
      background: "linear-gradient(135deg, #2ecc71 0%, #27ae60 100%)",
      color: "#fff"
    },
    "等待比賽": {
      background: "linear-gradient(135deg, #3498db 0%, #2980b9 100%)",
      color: "#fff"
    },
    "已淘汰": {
      background: "linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);",
      color: "#000"  // Changed from "#fff" to "#000"
    }
  };

  // Display SSC6 groups
  Object.entries(statusGroups).forEach(([status, groupCreators]) => {
    if (groupCreators.length > 0) {
      const header = document.createElement('div');
      header.style.padding = "10px 15px";
      header.style.marginBottom = "10px";
      header.style.borderRadius = "8px";
      header.style.fontSize = "1.1em";
      header.style.fontWeight = "bold";
      Object.assign(header.style, statusStyles[status]);
      header.textContent = status;
      rankingList.appendChild(header);

      groupCreators.forEach((creator, index) => {
        const li = document.createElement('li');
        li.className = 'ranking-item';
        
        const creatorStatus = ssc6Status[creator.name];
        const votingInfo = creatorStatus?.votes ? 
          `<div style="font-size: 0.9em; color: #666;">${creatorStatus.votes} - ${creatorStatus.rank}</div>` : '';
        
        li.innerHTML = `
          <div class="rank">${index + 1}</div>
          <div class="creator-info">
            <div class="creator-name">
              ${creator.name}
              ${creator.flag ? `<span class="flag">${creator.flag}</span>` : ''}
            </div>
            <div class="fans-count">
              ${formatNumber(creator.fans)} 追蹤
              ${votingInfo}
            </div>
          </div>
          <button class="music-btn" onclick="showNoMusicAlert()">
            <i class="fas fa-music"></i>
          </button>
        `;
        
        rankingList.appendChild(li);
      });
    }
  });

  // SSC5 Section
  const header5 = document.createElement('div');
  header5.style.padding = "15px";
  header5.style.marginTop = "30px";
  header5.style.marginBottom = "20px";
  header5.style.borderRadius = "8px";
  header5.style.fontSize = "1.3em";
  header5.style.fontWeight = "bold";
  header5.style.background = "linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%)";
  header5.style.color = "#fff";
  header5.textContent = "SSC5賽況 [已結束]";
  rankingList.appendChild(header5);

  // Display SSC5 participants
  const ssc5Header = document.createElement('div');
  ssc5Header.style.padding = "10px 15px";
  ssc5Header.style.marginBottom = "10px";
  ssc5Header.style.borderRadius = "8px";
  ssc5Header.style.fontSize = "1.1em";
  ssc5Header.style.fontWeight = "bold";
  Object.assign(ssc5Header.style, statusStyles["已淘汰"]);
  ssc5Header.textContent = "已淘汰";
  rankingList.appendChild(ssc5Header);

  creators.filter(c => ssc5Participants.includes(c.name)).forEach((creator, index) => {
    const li = document.createElement('li');
    li.className = 'ranking-item';
    
    li.innerHTML = `
      <div class="rank">${index + 1}</div>
      <div class="creator-info">
        <div class="creator-name">
          ${creator.name}
          ${creator.flag ? `<span class="flag">${creator.flag}</span>` : ''}
        </div>
        <div class="fans-count">
          ${formatNumber(creator.fans)} 追蹤
        </div>
      </div>
      <button class="music-btn" onclick="showNoMusicAlert()">
        <i class="fas fa-music"></i>
      </button>
    `;
    
    rankingList.appendChild(li);
  });
}

// Event listeners for view toggle
document.getElementById('followersView').onclick = function() {
  this.classList.add('active');
  document.getElementById('likesView').classList.remove('active');
  document.getElementById('ssc6View').classList.remove('active');
  document.getElementById('statsView').classList.remove('active');
  document.getElementById('joinUsView').classList.remove('active');
  currentView = 'followers';
  document.querySelector('.intro').style.display = 'block';
  document.getElementById('likesIntro').style.display = 'none';
  document.getElementById('ssc6Info').style.display = 'none'; // Hide SSC6 info
  document.getElementById('filterSelect').style.display = 'block'; // Show filter
  document.getElementById('joinUsSection').style.display = 'none'; // Add this
  updateList(creators);
  document.getElementById('statsSection').style.display = 'none';
  rankingList.style.display = 'block';
};

document.getElementById('likesView').onclick = function() {
  this.classList.add('active');
  document.getElementById('followersView').classList.remove('active');
  document.getElementById('ssc6View').classList.remove('active');
  document.getElementById('statsView').classList.remove('active');
  document.getElementById('joinUsView').classList.remove('active');
  currentView = 'likes';
  document.querySelector('.intro').style.display = 'none';
  document.getElementById('likesIntro').style.display = 'block';
  document.getElementById('ssc6Info').style.display = 'none'; // Hide SSC6 info
  document.getElementById('filterSelect').style.display = 'none'; // Hide filter
  document.getElementById('joinUsSection').style.display = 'none'; // Add this
  updateListForLikes();
  document.getElementById('statsSection').style.display = 'none';
  rankingList.style.display = 'block';
};

document.getElementById('ssc6View').onclick = function() {
  this.classList.add('active');
  document.getElementById('followersView').classList.remove('active');
  document.getElementById('likesView').classList.remove('active');
  document.getElementById('statsView').classList.remove('active');
  document.getElementById('joinUsView').classList.remove('active');
  currentView = 'ssc6';
  document.querySelector('.intro').style.display = 'none';
  document.getElementById('likesIntro').style.display = 'none';
  document.getElementById('filterSelect').style.display = 'none'; // Hide filter
  document.getElementById('ssc6Info').style.display = 'block'; // Show SSC6 info
  document.getElementById('joinUsSection').style.display = 'none'; // Add this
  updateListForSSC6();
  document.getElementById('statsSection').style.display = 'none';
  rankingList.style.display = 'block';
};

document.getElementById('statsView').onclick = function() {
  this.classList.add('active');
  document.getElementById('followersView').classList.remove('active');
  document.getElementById('likesView').classList.remove('active');
  document.getElementById('ssc6View').classList.remove('active');
  document.getElementById('joinUsView').classList.remove('active');
  currentView = 'stats';
  
  // Hide other views
  document.querySelector('.intro').style.display = 'none';
  document.getElementById('likesIntro').style.display = 'none';
  document.getElementById('ssc6Info').style.display = 'none'; // Hide SSC6 info
  document.getElementById('filterSelect').style.display = 'none';
  document.getElementById('rankingList').style.display = 'none';
  document.getElementById('joinUsSection').style.display = 'none'; // Add this
  
  // Show and initialize stats section
  document.getElementById('statsSection').style.display = 'block';
  createFollowersLineChart();
  createFollowersBarChart();
  createCountryDistributionChart();
  createSongLikesChart();
};

document.getElementById('joinUsView').onclick = function() {
  this.classList.add('active');
  document.getElementById('followersView').classList.remove('active');
  document.getElementById('likesView').classList.remove('active');
  document.getElementById('ssc6View').classList.remove('active');
  document.getElementById('statsView').classList.remove('active');
  
  // Hide other sections
  document.querySelector('.intro').style.display = 'none';
  document.getElementById('likesIntro').style.display = 'none';
  document.getElementById('ssc6Info').style.display = 'none';
  document.getElementById('filterSelect').style.display = 'none';
  document.getElementById('rankingList').style.display = 'none';
  document.getElementById('statsSection').style.display = 'none';
  
  // Show join us section
  document.getElementById('joinUsSection').style.display = 'block';
};

document.getElementById('joinUsForm').onsubmit = function(e) {
  e.preventDefault();
  
  const randomCode = Math.random().toString(36).substring(2, 10).toUpperCase();
  
  document.getElementById('randomCode').textContent = randomCode;
  document.getElementById('resultName').textContent = document.getElementById('authorName').value;
  document.getElementById('resultNationality').textContent = document.getElementById('nationality').value;
  document.getElementById('resultFollowers').textContent = document.getElementById('followers').value;
  
  document.getElementById('submissionResult').style.display = 'block';
  
  // Optional: Clear form
  this.reset();
};

// Modify the filter select event listener
document.getElementById('filterSelect').addEventListener('change', (e) => {
  if (currentView === 'followers') {
    const filteredCreators = filterCreators(e.target.value);
    updateList(filteredCreators);
  } else if (currentView === 'likes') {
    updateListForLikes(); // For likes view, we'll show all for now
  }
});

// Update the createFollowersLineChart function to destroy existing chart
function createFollowersLineChart() {
  if (followersLineChart) {
    followersLineChart.destroy();
  }
  const ctx = document.getElementById('followersLineChart').getContext('2d');
  const datasets = creators.map(creator => ({
    label: creator.name,
    data: [previousData[creator.name] || 0, creator.fans],
    borderColor: `hsl(${Math.random() * 360}, 70%, 50%)`,
    tension: 0.4
  }));

  followersLineChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['上月', '本月'],
      datasets: datasets
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: '追蹤數變化趨勢'
        }
      }
    }
  });
}

// Update the createFollowersBarChart function
function createFollowersBarChart() {
  if (followersBarChart) {
    followersBarChart.destroy();
  }
  const ctx = document.getElementById('followersBarChart').getContext('2d');
  const sortedCreators = [...creators].sort((a, b) => b.fans - a.fans);
  
  followersBarChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: sortedCreators.map(c => c.name),
      datasets: [{
        label: '追蹤數',
        data: sortedCreators.map(c => c.fans),
        backgroundColor: '#3498db'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: '追蹤數分布'
        }
      }
    }
  });
}

// Update the createCountryDistributionChart function
function createCountryDistributionChart() {
  if (countryChart) {
    countryChart.destroy();
  }
  const ctx = document.getElementById('countryChart').getContext('2d');
  const countryCount = {};
  
  creators.forEach(creator => {
    if (creator.flag) {
      const country = creator.flag === '🇹🇼' ? '台灣' :
                     creator.flag === '🇯🇵' ? '日本' :
                     creator.flag === '🇲🇾' ? '馬來西亞' :
                     creator.flag === '🇨🇳' ? '中國' : '其他';
      countryCount[country] = (countryCount[country] || 0) + 1;
    }
  });

  countryChart = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: Object.keys(countryCount),
      datasets: [{
        data: Object.values(countryCount),
        backgroundColor: ['#3498db', '#e74c3c', '#2ecc71', '#f1c40f', '#9b59b6']
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: '創作者國籍分布'
        }
      }
    }
  });
}

// Update the createSongLikesChart function
function createSongLikesChart() {
  if (likesBarChart) {
    likesBarChart.destroy();
  }
  const ctx = document.getElementById('likesBarChart').getContext('2d');
  const sortedLikes = [...songLikes].sort((a, b) => b.likes - a.likes);

  likesBarChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: sortedLikes.map(s => s.name),
      datasets: [{
        label: '按讚數',
        data: sortedLikes.map(s => s.likes),
        backgroundColor: '#2ecc71'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: '熱門曲目按讚數'
        }
      }
    }
  });
}

// Call the function after initial load
updateList(creators);
</script>

</body></html>